<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SummarizedBenchmark: Full Case Study • SummarizedBenchmark</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SummarizedBenchmark: Full Case Study">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SummarizedBenchmark</a>
        <span class="label label-info" data-toggle="tooltip" data-placement="bottom" title="Bioc Devel">1.99.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SummarizedBenchmark-Introduction.html">Introduction</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General</li>
    <li>
      <a href="../articles/SummarizedBenchmark-Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-ClassDetails.html">Class Details</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-FullCaseStudy.html">Full Case Study</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Features</li>
    <li>
      <a href="../articles/Feature-ErrorHandling.html">Error Handling</a>
    </li>
    <li>
      <a href="../articles/Feature-Iterative.html">Iterative Benchmarking</a>
    </li>
    <li>
      <a href="../articles/Feature-Parallel.html">Parallelization</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">More Case Studies</li>
    <li>
      <a href="../articles/CaseStudy-SingleCellSimulation.html">scRNA-seq Simulation</a>
    </li>
    <li>
      <a href="../articles/CaseStudy-RNAseqQuantification.html">RNA-seq Quantification</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/areyesq89/SummarizedBenchmark">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>SummarizedBenchmark: Full Case Study</h1>
                        <h4 class="author">Patrick K. Kimes, Alejandro Reyes</h4>
            
            <h4 class="date">29 October 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/areyesq89/SummarizedBenchmark/blob/master/vignettes/SummarizedBenchmark-FullCaseStudy.Rmd"><code>vignettes/SummarizedBenchmark-FullCaseStudy.Rmd</code></a></small>
      <div class="hidden name"><code>SummarizedBenchmark-FullCaseStudy.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      “While the foundations of the <code>SummarizedBenchmark</code> framework are introduced in the <strong>SummarizedBenchmark: Introduction</strong> vignette, this vignette provides a more detailed case study of performing a benchmarking comparison using the package. A more complex example of comparing methods for differential gene expression testing with RNA-seq data is presented, and used to motivate and demonstrate several core features of the <code>SummarizedBenchmark</code> approach. SummarizedBenchmark package version: 1.99.2”
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this case study, we assume that the reader is familiar with the material presented in the <strong>SummarizedBenchmark: Introduction</strong> vignette, and to a lesser extent, the content of the <strong>SummarizedBenchmark: Class Details</strong> vignette. These two vignettes provide a higher level introduction to the package, and if possible, should be read first.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"SummarizedBenchmark"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"magrittr"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(<span class="st">"limma"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(<span class="st">"edgeR"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(<span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(<span class="st">"tximport"</span>)</a></code></pre></div>
<p>We use a simulated data set from <span class="citation">(Soneson and Robinson 2016)</span> to demonstrate how the <code>SummarizedBenchmark</code> package can be used to benchmark methods for differential expression analysis. Namely, we compare the methods implemented in the <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em>, <em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>, and <em><a href="http://bioconductor.org/packages/limma">limma</a></em> packages. The simulated data set includes 6 samples of three replicates each from two conditions. For each sample, transcript-level expression is provided as transcripts per-million (TPM) values for 15,677 transcripts from human chromosome 1 (Ensembl GRCh37.71). A more complete description of the data, including code for how the data ws generated, is available in the Supplementary Materials of <span class="citation">(Soneson and Robinson 2016)</span> <a href="http://dx.doi.org/10.5256/f1000research.7563.d114722">here</a>. We provide precomputed objects containing these count and ground truth data. Details on how the objects were generated are included in the <a href="#appendix">Appendix</a> at the end of this vignette.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">data</span>(<span class="st">"soneson2016"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">head</span>(txi<span class="op">$</span>counts)</a></code></pre></div>
<pre><code>##                         A1          A2         A3         B1        B2
## ENST00000367770   1.670571   0.8064829   5.472561  58.700418  32.89297
## ENST00000367771 558.834722 458.8887676 662.352695   5.299743  20.73813
## ENST00000367772 155.881534 110.6033685 183.417201   0.000000   0.00000
## ENST00000423670  11.809207  16.4752934  10.426669  20.392491   1.26733
## ENST00000470238  96.489863  34.2755231  32.489730 785.514128 614.71261
## ENST00000286031  12.442872  13.4797855   4.781290   1.152118  20.50770
##                         B3
## ENST00000367770  16.648100
## ENST00000367771  14.862318
## ENST00000367772   0.000000
## ENST00000423670   7.546371
## ENST00000470238 815.123229
## ENST00000286031   5.760588</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">head</span>(truthdat)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   transcript status logFC_cat   logFC avetpm length eff_length   tpm1  tpm2
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 ENST00000…      1 [ 3.38,3…   4.17   0.225   2916      2771. 0.0237 0.427
## 2 ENST00000…      1 [ 3.38,3…   5.25   3.20    2921      2776. 6.23   0.164
## 3 ENST00000…      1 Inf       Inf      0.817   3477      3332. 1.63   0    
## 4 ENST00000…      1 [ 0.00, …   0.322  0.203   2077      1932. 0.181  0.226
## 5 ENST00000…      1 [ 3.38,3…   4.07   4.08    1538      1393. 0.460  7.71 
## 6 ENST00000…      0 [ 0.00, …   0      0.154   4355      4210. 0.154  0.154
## # ... with 4 more variables: isopct1 &lt;dbl&gt;, isopct2 &lt;dbl&gt;, gene &lt;chr&gt;,
## #   avetpm_cat &lt;chr&gt;</code></pre>
</div>
<div id="benchmark-set-up-and-execution" class="section level1">
<h1 class="hasAnchor">
<a href="#benchmark-set-up-and-execution" class="anchor"></a>Benchmark Set-Up and Execution</h1>
<p>We begin the benchmarking process by creating our <em>BenchDesign</em> object with the data set. The <em>BenchDesign</em> can be initialized with a <em>data.frame</em> (as in the <strong>Introduction</strong> vignette), or more generally, with a list object, or optionally, without any data. In this case study, since methods for differential expression require more than just the expression counts, e.g. the experimental design, we construct the data set as a list containing each of these inputs as a named entry.</p>
<p>The scaled TPM values are rounded before passing to the differential expression methods.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">mycounts &lt;-<span class="st"> </span><span class="kw">round</span>(txi<span class="op">$</span>counts)</a></code></pre></div>
<p>Here, we simply use the the conditions for each sample to define the experimental design. The design matrix is stored as a <em>data.frame</em>, <code>mycoldat</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">mycoldat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">condition =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">rownames</span>(mycoldat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(mycounts)</a></code></pre></div>
<p>The data object for the benchmark experiment is now constructed with both the counts and the design matrix, along with some ground truth information (“status”: the true presence or absence of differential expression between conditions, and “lfc”: the expected log-fold change between conditions).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">mydat &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">coldat =</span> mycoldat,</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">              <span class="dt">cntdat =</span> mycounts,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">              <span class="dt">status =</span> truthdat<span class="op">$</span>status,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">              <span class="dt">lfc =</span> truthdat<span class="op">$</span>logFC)</a></code></pre></div>
<p>The <em>BenchDesign</em> is constructed with the data as the sole input.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat)</a></code></pre></div>
<p>For simplicity, we focus on comparing only the p-values returned by each method after testing for differential expression between the two conditions. However, later in this vignette, we also show how multiple metrics (p-values and log-fold change) can be compared in a single <em>BenchDesign</em> object.</p>
<p>Since each method requires running multiple steps, we write two wrapper functions for each method - a function to first return the primary analysis result, and a second function to extract pvalues from the results.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">deseq2_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                                  <span class="dt">colData =</span> colData,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                                  <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">    <span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds, <span class="dt">contrast =</span> contrast)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">deseq2_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">    x<span class="op">$</span>pvalue</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"></a>
<a class="sourceLine" id="cb10-12" data-line-number="12">edgeR_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/estimateDisp">estimateDisp</a></span>(y, des)</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">    fit &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmFit</a></span>(y, des)</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">    <span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmLRT</a></span>(fit, <span class="dt">coef=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">}</a>
<a class="sourceLine" id="cb10-20" data-line-number="20">edgeR_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-21" data-line-number="21">    x<span class="op">$</span>table<span class="op">$</span>PValue</a>
<a class="sourceLine" id="cb10-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb10-23" data-line-number="23"></a>
<a class="sourceLine" id="cb10-24" data-line-number="24">voom_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb10-25" data-line-number="25">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb10-26" data-line-number="26">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb10-28" data-line-number="28">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/voom">voom</a></span>(y, des)</a>
<a class="sourceLine" id="cb10-29" data-line-number="29">    <span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/ebayes">eBayes</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/lmFit">lmFit</a></span>(y, des))</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">}</a>
<a class="sourceLine" id="cb10-31" data-line-number="31">voom_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">    x<span class="op">$</span>p.value[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb10-33" data-line-number="33">}</a></code></pre></div>
<p>Note that we could also simply write a single wrapper function to returns only the vector of p-values for each method, e.g. combined <code>deseq2_run()</code> and <code>deseq2_pv()</code> into a single function. Here we separate the function into two wrappers solely for the purpose of clarity and consistency with later examples in this vignette. There is no advantage to separating the wrapper into two smaller functions. Next, each method is added to the <em>BenchDesign</em> using <code><a href="../reference/addMethod.html">addMethod()</a></code>, and the corresponding wrapper function passed as <code>func</code>. (For a review of the basic usage of <code><a href="../reference/addMethod.html">addMethod()</a></code>, revist the <strong>SummarizedBenchmark: Introduction</strong> vignette.) We use the pipe notation for compactness.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">bd &lt;-<span class="st"> </span>bd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">              <span class="dt">func =</span> deseq2_run,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">              <span class="dt">post =</span> deseq2_pv,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">              <span class="dt">func =</span> edgeR_run,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">              <span class="dt">post =</span> edgeR_pv,</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>,</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">              <span class="dt">func =</span> voom_run,</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">              <span class="dt">post =</span> voom_pv, </a>
<a class="sourceLine" id="cb11-20" data-line-number="20">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">              )</a></code></pre></div>
<p>So far, none of the methods have been executed. The <em>BenchDesign</em> object simply serves as a container describing <em>how</em> the methods should be executed. The methods are applied by a simple call to <code><a href="../reference/buildBench.html">buildBench()</a></code>. Since the ground truth is known and available in <code>mydat$status</code>, this is specified to <code>truthCols=</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">truthCols =</span> <span class="st">"status"</span>)</a></code></pre></div>
<p>We can inspect the results.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">sb</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(1): status
## rownames: NULL
## rowData names(1): status
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
</div>
<div id="benchmark-evaluation" class="section level1">
<h1 class="hasAnchor">
<a href="#benchmark-evaluation" class="anchor"></a>Benchmark Evaluation</h1>
<p>By running the code above, the results of three differential expression methods (<em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>, <em><a href="http://bioconductor.org/packages/limma">limma</a></em>-voom and <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em> will be stored in a <code>SummarizedBenchmark</code> container. The next step is to define metrics to evaluate the performance of these three methods. This can be done by using the function <code><a href="../reference/addPerformanceMetric.html">addPerformanceMetric()</a></code>, as described before in the <strong>Introduction</strong> vignette. In this package there are implementations for several ‘default’ metrics that are commonly used to evaluate methods. The function <code><a href="../reference/availableMetrics.html">availableMetrics()</a></code> returns a <em>data.frame</em> of these metrics.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../reference/availableMetrics.html">availableMetrics</a></span>()</a></code></pre></div>
<pre><code>##            functions                                   description
## 1         rejections                          Number of rejections
## 2                TPR                            True Positive Rate
## 3                TNR                            True Negative Rate
## 4                FDR              False Discovery Rate (estimated)
## 5                FNR                           False Negative Rate
## 6        correlation                           Pearson correlation
## 7               sdad Standard Deviation of the Absolute Difference
## 8            hamming                              Hamming distance
## 9             LPnorm                                    L_{p} norm
## 10 adjustedRandIndex                           Adjusted Rand Index
##    requiresTruth
## 1          FALSE
## 2           TRUE
## 3           TRUE
## 4           TRUE
## 5           TRUE
## 6           TRUE
## 7           TRUE
## 8           TRUE
## 9           TRUE
## 10          TRUE</code></pre>
<p>The predefined metrics <code>rejections</code>, <code>TPR</code>, <code>TNR</code>, <code>FDR</code> and <code>FNR</code> can be added to the assay <code>H</code> of our object using the following code.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addPerformanceMetric.html">addPerformanceMetric</a></span>(sb, <span class="dt">evalMetric =</span> <span class="kw">c</span>(<span class="st">"rejections"</span>, <span class="st">"TPR"</span>, <span class="st">"TNR"</span>, <span class="st">"FDR"</span>, <span class="st">"FNR"</span>),</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                           <span class="dt">assay =</span> <span class="st">"status"</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw">names</span>(<span class="kw"><a href="../reference/performanceMetrics.html">performanceMetrics</a></span>(sb)[[<span class="st">"status"</span>]])</a></code></pre></div>
<pre><code>## [1] "rejections" "TPR"        "TNR"        "FDR"        "FNR"</code></pre>
<p>Having defined the desired performance metrics, the function <code><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics()</a></code> will calculate these metrics for each of the three methods.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dt">tidy =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">    </span>dplyr<span class="op">:::</span><span class="kw">select</span>(label, value, performanceMetric, alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="st">    </span><span class="kw">tail</span>()</a></code></pre></div>
<pre><code>## Warning: `lang()` is soft-deprecated as of rlang 0.2.0.
## Please use `call2()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `new_overscope()` is soft-deprecated as of rlang 0.2.0.
## Please use `new_data_mask()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `overscope_eval_next()` is soft-deprecated as of rlang 0.2.0.
## Please use `eval_tidy()` with a data mask instead
## This warning is displayed once per session.</code></pre>
<pre><code>##     label      value performanceMetric alpha
## 55 deseq2 0.10988246               FNR   0.1
## 56  edgeR 0.09381113               FNR   0.1
## 57   voom 0.11381970               FNR   0.1
## 58 deseq2 0.09223211               FNR   0.2
## 59  edgeR 0.07986767               FNR   0.2
## 60   voom 0.08741018               FNR   0.2</code></pre>
<p>Furthermore, the functions <code><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap()</a></code> and <code><a href="../reference/plotROC.html">plotROC()</a></code> are helpful to visualize the performance of the different methods, in case these methods output q-values.</p>
<p><code><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap()</a></code> is a wrapper for the function <code>upset()</code> from the <em><a href="https://CRAN.R-project.org/package=UpSetR">UpSetR</a></em> package that is helpful to visualize the overlaps between hits of different methods for a given alpha value.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap</a></span>(sb, <span class="dt">assay =</span> <span class="st">"status"</span>, <span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">order.by =</span> <span class="st">"freq"</span>)</a></code></pre></div>
<p><img src="SummarizedBenchmark-FullCaseStudy_files/figure-html/unnamed-chunk-13-1.png" width="432"></p>
<p>From the plot above, it is evident that there is a large number of transcripts that are detected to be differentially expressed by all three methods. There are also smallers sets of transcripts that are detected uniquely by a single method or subsets of methods. Another typical way to compare the performance of different methods are Receiver Operating Characteristic (ROC) curves. The function <code><a href="../reference/plotROC.html">plotROC()</a></code> inputs a <em>SummarizeBenchmark</em> object and draws the ROC curves for all methods contained in it.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">SummarizedBenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/SummarizedBenchmark/topics/plotROC">plotROC</a></span>(sb, <span class="dt">assay =</span> <span class="st">"status"</span>)</a></code></pre></div>
<p><img src="SummarizedBenchmark-FullCaseStudy_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
</div>
<div id="storing-multiple-outputs" class="section level1">
<h1 class="hasAnchor">
<a href="#storing-multiple-outputs" class="anchor"></a>Storing Multiple Outputs</h1>
<p>The case study described above has assumed that we are interested in a single numeric vector for each method, namely, a vector of p-values. These p-values are stored as the sole <code>assay</code> in the <em>SummarizedBenchmark</em> object returned by <code><a href="../reference/buildBench.html">buildBench()</a></code>. However, in many cases, there are multiple values of interest to be compared across methods. For example, looking at the estimated log-fold changes in addition to p-values may be informative when comparing methods for differential expression.</p>
<p>The <em>BenchDesign</em> framework supports multiple assays with the <code>post =</code> parameter of the <code><a href="../reference/addMethod.html">addMethod()</a></code> call. When zero or one function is specified to <code>post =</code> for all methods, as in the examples above, the results are stored as a single <code>assay</code>. However, if <code>post =</code> is passed a named list of functions, separate <code>assay</code>s will be created using the names and functions in each list. Since the <code>assay</code> names are taken from <code>post =</code>, all entries in the list must be named. Furthermore, since results are matched across methods using the assay names, if a method is missing a <code>post =</code> function for a given assay name, the corresponding column in the <code>assay</code>s will be set to <code>NA</code>.</p>
<p>To track both p-values and log-fold change values for each method, we write a new set of wrapper functions to extract log-fold changes for each method, similar to the wrapper functions written earlier for extracting p-values. Unlike the case above where we only wanted the p-values of each method, we cannot simple write a single wrapper function for running methods and extracting the results. Instead, separate <code>func =</code> and <code>post =</code> specifications are necessary.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">deseq2_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb26-2" data-line-number="2">    x<span class="op">$</span>log2FoldChange</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5">edgeR_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">    x<span class="op">$</span>table<span class="op">$</span>logFC</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb26-8" data-line-number="8"></a>
<a class="sourceLine" id="cb26-9" data-line-number="9">voom_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">    x<span class="op">$</span>coefficients[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">}</a></code></pre></div>
<p>The primary wrapper function and a list of accessor functions are passed to <code>func =</code> and <code>post =</code> respectively.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">              <span class="dt">func =</span> deseq2_run,</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> deseq2_pv,</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                          <span class="dt">lfc =</span> deseq2_lfc),</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb27-8" data-line-number="8">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb27-10" data-line-number="10">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">              <span class="dt">func =</span> edgeR_run,</a>
<a class="sourceLine" id="cb27-13" data-line-number="13">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> edgeR_pv,</a>
<a class="sourceLine" id="cb27-14" data-line-number="14">                          <span class="dt">lfc =</span> edgeR_lfc),</a>
<a class="sourceLine" id="cb27-15" data-line-number="15">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb27-16" data-line-number="16">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb27-17" data-line-number="17">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb27-18" data-line-number="18">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-19" data-line-number="19"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>,</a>
<a class="sourceLine" id="cb27-20" data-line-number="20">              <span class="dt">func =</span> voom_run,</a>
<a class="sourceLine" id="cb27-21" data-line-number="21">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> voom_pv,</a>
<a class="sourceLine" id="cb27-22" data-line-number="22">                          <span class="dt">lfc =</span> voom_lfc),</a>
<a class="sourceLine" id="cb27-23" data-line-number="23">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb27-24" data-line-number="24">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb27-25" data-line-number="25">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb27-26" data-line-number="26">              )</a></code></pre></div>
<p>When the <em>BenchDesign</em> is evaluated using <code><a href="../reference/buildBench.html">buildBench()</a></code>, the resulting <em>SummarizedBenchmark</em> will be generated with two assays: <code>"pv"</code> and <code>"lfc"</code>. As before, the ground truth can be specified using the <code>truthCols =</code> parameter. When multiple assays are used, <code>truthCols =</code> expects a named vector of <code>assay-name = "column-name"</code> pairs.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(<span class="dt">bd =</span> bd, <span class="dt">truthCols =</span> <span class="kw">c</span>(<span class="dt">pv =</span> <span class="st">"status"</span>, <span class="dt">lfc =</span> <span class="st">"lfc"</span>))</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">sb</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
<p>We can verify that the two assays contain the expected values.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb, <span class="st">"pv"</span>))</a></code></pre></div>
<pre><code>##            deseq2        edgeR         voom
## [1,] 2.875541e-04 2.074073e-04 6.103023e-03
## [2,] 2.799371e-23 2.121422e-16 1.239445e-04
## [3,] 8.450676e-14 3.109331e-18 5.221157e-06
## [4,] 6.930834e-01 6.621236e-01 3.357040e-01
## [5,] 2.479616e-11 2.468951e-09 3.978989e-04
## [6,] 9.057130e-01 8.947438e-01 5.199404e-01</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb, <span class="st">"lfc"</span>))</a></code></pre></div>
<pre><code>##          deseq2       edgeR       voom
## [1,]  3.7329019   3.6767779  3.5232524
## [2,] -5.3905346  -5.3773940 -5.5543949
## [3,] -9.7125453 -10.2467488 -8.2533275
## [4,] -0.4706410  -0.4547095 -1.0510456
## [5,]  3.7048724   3.7024426  3.9084940
## [6,] -0.1554938  -0.1504299 -0.7607029</code></pre>
<p>The results stored in each assay of the <em>SummarizedBenchmark</em> object can now be analyzed in the same way as before.</p>
</div>
<div id="recycling-a-benchdesign" class="section level1">
<h1 class="hasAnchor">
<a href="#recycling-a-benchdesign" class="anchor"></a>Recycling a BenchDesign</h1>
<p>Early on, we mentioned that a <em>BenchDesign</em> can be initialized without any data. Here, we describe why this is supported and how to run <code><a href="../reference/buildBench.html">buildBench()</a></code> on a <em>BenchDesign</em> not containing a data set.</p>
<p>When benchmarking several methods, it is generally considered good practice to apply the methods to more than just a single data set. Under the SummarizedBenchmark framework, this naturally translates to recycling the same set of methods defined in a single <em>BenchDesign</em> object across multiple data sets. First, we initialize a <em>BenchDesign</em> without any methods or data set.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">bdnull &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>()</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">bdnull</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     NULL
##   benchmark methods:
##     none</code></pre>
<p>As before, methods can be added to the <em>BenchDesign</em> with <code><a href="../reference/addMethod.html">addMethod()</a></code>, and the benchmark experiment run using <code><a href="../reference/buildBench.html">buildBench()</a></code>.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">bdnull &lt;-<span class="st"> </span>bdnull <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"bonf"</span>,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">              <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval,</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">                                   <span class="dt">method =</span> <span class="st">"bonferroni"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"BH"</span>,</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">              <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval,</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">                                   <span class="dt">method =</span> <span class="st">"BH"</span>))</a></code></pre></div>
<p>The <code><a href="../reference/buildBench.html">buildBench()</a></code> method accepts an optional <code>data =</code> parameter. When specified, this data set is used to run the experiment, taking precedence over the data set specified in (or missing from) the <em>BenchDesign</em> object.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bdnull, <span class="dt">data =</span> tdat)</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 50 2 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(2): bonf BH
## colData names(6): func.pkg func.pkg.vers ... param.method
##   session.idx</code></pre>
<p>By specifying data during the <code><a href="../reference/buildBench.html">buildBench()</a></code> step, the exact same benchmark comparison, as defined in the common <em>BenchDesign</em> object, can be carried out consistently across multiple data sets. While this approach works even if the common <em>BenchDesign</em> object contains a default data set, it is recommended that the <em>BenchDesign</em> be created without any data to avoid errors if the design is going to be reused across data sets.</p>
</div>
<div id="next-steps" class="section level1">
<h1 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps</h1>
<p>The most important features of the <code>SummarizedBenchmark</code> workflow were demonstrated in this vignette. Additional features and topics, including how <strong>error handling</strong>, <strong>iterative benchmarking</strong>, and <strong>parallelization</strong> can be found in separate vignettes.</p>
</div>
<div id="appendix" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h1>
<p>Here, we describe how the data using The data is available for download from ArrayExpress. Expression data for each sample is provided in the RSEM output format. Corresponding information for the ground truth underlying the simulated data is also available, including transcript differential expression status.</p>
<p>First, we download and import the transcript-level TPM values using the tximport 1.8.0 package and store this data in an object called <code>txi</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">library</span>(tximport)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3"></a>
<a class="sourceLine" id="cb39-4" data-line-number="4">d &lt;-<span class="st"> </span><span class="kw">tempdir</span>()</a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="kw">paste0</span>(<span class="st">"https://www.ebi.ac.uk/arrayexpress/files/"</span>,</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">                           <span class="st">"E-MTAB-4119/E-MTAB-4119.processed.3.zip"</span>),</a>
<a class="sourceLine" id="cb39-7" data-line-number="7">              <span class="dt">destfile =</span> <span class="kw">file.path</span>(d, <span class="st">"samples.zip"</span>))</a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="kw">unzip</span>(<span class="kw">file.path</span>(d, <span class="st">"samples.zip"</span>), <span class="dt">exdir =</span> d)</a>
<a class="sourceLine" id="cb39-9" data-line-number="9"></a>
<a class="sourceLine" id="cb39-10" data-line-number="10">fl &lt;-<span class="st"> </span><span class="kw">list.files</span>(d, <span class="dt">pattern =</span> <span class="st">"*_rsem.txt"</span>, <span class="dt">full.names=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb39-11" data-line-number="11"><span class="kw">names</span>(fl) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">"sample(.*)_rsem.txt"</span>, <span class="st">"</span><span class="ch">\\</span><span class="st">1"</span>, <span class="kw">basename</span>(fl))</a>
<a class="sourceLine" id="cb39-12" data-line-number="12"></a>
<a class="sourceLine" id="cb39-13" data-line-number="13">txi &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tximport/topics/tximport">tximport</a></span>(fl, <span class="dt">txIn =</span> <span class="ot">TRUE</span>, <span class="dt">txOut =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb39-14" data-line-number="14">                <span class="dt">geneIdCol =</span> <span class="st">"gene_id"</span>,</a>
<a class="sourceLine" id="cb39-15" data-line-number="15">                <span class="dt">txIdCol =</span> <span class="st">"transcript_id"</span>,</a>
<a class="sourceLine" id="cb39-16" data-line-number="16">                <span class="dt">countsCol =</span> <span class="st">"expected_count"</span>,</a>
<a class="sourceLine" id="cb39-17" data-line-number="17">                <span class="dt">lengthCol =</span> <span class="st">"effective_length"</span>,</a>
<a class="sourceLine" id="cb39-18" data-line-number="18">                <span class="dt">abundanceCol =</span> <span class="st">"TPM"</span>,</a>
<a class="sourceLine" id="cb39-19" data-line-number="19">                <span class="dt">countsFromAbundance =</span> <span class="st">"scaledTPM"</span>,</a>
<a class="sourceLine" id="cb39-20" data-line-number="20">                <span class="dt">importer =</span> <span class="cf">function</span>(x){ readr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_tsv</a></span>(x) })</a></code></pre></div>
<p>Next, we obtain and load the ground truth information that can be used for evaluating the results of the differential expression analysis and keep this as a <em>tibble</em> called <code>truthdat</code>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="kw">paste0</span>(<span class="st">"https://www.ebi.ac.uk/arrayexpress/files/"</span>,</a>
<a class="sourceLine" id="cb40-2" data-line-number="2">                           <span class="st">"E-MTAB-4119/E-MTAB-4119.processed.2.zip"</span>),</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">              <span class="dt">destfile =</span> <span class="kw">file.path</span>(d, <span class="st">"truth.zip"</span>))</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="kw">unzip</span>(<span class="kw">file.path</span>(d, <span class="st">"truth.zip"</span>), <span class="dt">exdir =</span> d)</a>
<a class="sourceLine" id="cb40-5" data-line-number="5"></a>
<a class="sourceLine" id="cb40-6" data-line-number="6">truthdat &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_tsv</a></span>(<span class="kw">file.path</span>(d, <span class="st">"truth_transcript.txt"</span>))</a></code></pre></div>
<p>We save the <code>tximport</code> results and truth <em>tibble</em> for use in this package.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">save</span>(txi, truthdat, <span class="dt">file =</span> <span class="st">"../data/soneson2016.rda"</span>)</a></code></pre></div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Soneson_2016">
<p>Soneson, Charlotte, and Mark D Robinson. 2016. “iCOBRA: Open, Reproducible, Standardized and Live Method Benchmarking.” <em>Nature Methods</em> 13 (4):283–83. <a href="https://doi.org/10.1038/nmeth.3805" class="uri">https://doi.org/10.1038/nmeth.3805</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#benchmark-set-up-and-execution">Benchmark Set-Up and Execution</a></li>
      <li><a href="#benchmark-evaluation">Benchmark Evaluation</a></li>
      <li><a href="#storing-multiple-outputs">Storing Multiple Outputs</a></li>
      <li><a href="#recycling-a-benchdesign">Recycling a BenchDesign</a></li>
      <li><a href="#next-steps">Next Steps</a></li>
      <li><a href="#appendix">Appendix</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://alejandroreyes.org">Alejandro Reyes</a>, <a href="https://www.pkimes.com">Patrick Kimes</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
