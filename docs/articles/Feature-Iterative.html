<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Feature: Iterative Benchmarking • SummarizedBenchmark</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Feature: Iterative Benchmarking">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SummarizedBenchmark</a>
        <span class="label label-info" data-toggle="tooltip" data-placement="bottom" title="Bioc Devel">1.99.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SummarizedBenchmark-Introduction.html">Quick Start</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General</li>
    <li>
      <a href="../articles/SummarizedBenchmark-Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-ClassDetails.html">Class Details</a>
    </li>
    <li>
      <a href="../articles/SummarizedBenchmark-FullCaseStudy.html">Full Case Study</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Features</li>
    <li>
      <a href="../articles/Feature-ErrorHandling.html">Error Handling</a>
    </li>
    <li>
      <a href="../articles/Feature-Iterative.html">Iterative Benchmarking</a>
    </li>
    <li>
      <a href="../articles/Feature-Parallel.html">Parallelization</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">More Case Studies</li>
    <li>
      <a href="../articles/CaseStudy-SingleCellSimulation.html">scRNA-seq Simulation</a>
    </li>
    <li>
      <a href="../articles/CaseStudy-RNAseqQuantification.html">RNA-seq Quantification</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/areyesq89/SummarizedBenchmark">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Feature: Iterative Benchmarking</h1>
                        <h4 class="author">Patrick K. Kimes, Alejandro Reyes</h4>
            
            <h4 class="date">29 October 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/areyesq89/SummarizedBenchmark/blob/master/vignettes/Feature-Iterative.Rmd"><code>vignettes/Feature-Iterative.Rmd</code></a></small>
      <div class="hidden name"><code>Feature-Iterative.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      “Benchmark comparisons are often performed iteratively, with new methods added to the comparison or existing methods updated with new versions or features. Here, we describe the features currently available in the <code>SummarizedBenchmark</code> package for handling iterative benchmarking using an example case study. SummarizedBenchmark package version: 1.99.2”
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Often, benchmarking analyses are performed in multiple steps, iteratively, with methods added or updated based on previous results. Additionally, over the course of a benchmarking study, developers may update methods to improve the implementation or add new features. Ideally, whenever a method is updated or added, the benchmark results should also be updated. Naively, all methods in the benchmark could be re-computed by calling <code><a href="../reference/buildBench.html">buildBench()</a></code> on the original <em>BenchDesign</em> whenever the benchmarker notices that a method has been changed. However, not only is this computational inefficient, but requires the benchmarker to manually check if any methods have become outdated.</p>
<p>To make this process easier, the package includes the <code><a href="../reference/updateBench.html">updateBench()</a></code> function which can be used to both check if any results in a <em>SummarizedBenchmark</em> object need to be updated, and to update these results if necessary.</p>
<div id="example-case-study" class="section level2">
<h2 class="hasAnchor">
<a href="#example-case-study" class="anchor"></a>Example Case Study</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"SummarizedBenchmark"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"magrittr"</span>)</a></code></pre></div>
<p>To demonstrate the use of <code><a href="../reference/updateBench.html">updateBench()</a></code>, we use the same example of comparing methods for differential expression used in the <strong>SummarizedBenchmark: Full Case Study</strong> vignette. The <em>BenchDesign</em> is initialized using RNA-seq count data and ground truth information included with the package. The data is described in more detail in the <strong>Full Case Study</strong> vignette.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"limma"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"edgeR"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">library</span>(<span class="st">"tximport"</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">data</span>(soneson2016)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">mycounts &lt;-<span class="st"> </span><span class="kw">round</span>(txi<span class="op">$</span>counts)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">mycoldat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">condition =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">rownames</span>(mycoldat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(mycounts)</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">mydat &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">coldat =</span> mycoldat, <span class="dt">cntdat =</span> mycounts,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">              <span class="dt">status =</span> truthdat<span class="op">$</span>status, <span class="dt">lfc =</span> truthdat<span class="op">$</span>logFC)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat)</a></code></pre></div>
<p>Three methods for differential expression testing implemented in the <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em>, <em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>, and <em><a href="http://bioconductor.org/packages/limma">limma</a></em> packages are added to the benchmark. The p-values and log-fold change (LFC) values are stored for each method, as before.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">deseq2_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData, <span class="dt">colData =</span> colData, <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    <span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds, <span class="dt">contrast =</span> contrast)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">deseq2_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>pvalue }</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">deseq2_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>log2FoldChange }</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">edgeR_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/estimateDisp">estimateDisp</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    fit &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmFit</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    <span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmLRT</a></span>(fit, <span class="dt">coef=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">edgeR_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>table<span class="op">$</span>PValue }</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">edgeR_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>table<span class="op">$</span>logFC }</a>
<a class="sourceLine" id="cb3-19" data-line-number="19"></a>
<a class="sourceLine" id="cb3-20" data-line-number="20">voom_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb3-22" data-line-number="22">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/voom">voom</a></span>(y, des)</a>
<a class="sourceLine" id="cb3-25" data-line-number="25">    <span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/ebayes">eBayes</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/lmFit">lmFit</a></span>(y, des))</a>
<a class="sourceLine" id="cb3-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb3-27" data-line-number="27">voom_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>p.value[, <span class="dv">2</span>] }</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">voom_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) { x<span class="op">$</span>coefficients[, <span class="dv">2</span>] }</a>
<a class="sourceLine" id="cb3-29" data-line-number="29"></a>
<a class="sourceLine" id="cb3-30" data-line-number="30">bd &lt;-<span class="st"> </span>bd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>, <span class="dt">func =</span> deseq2_run,</a>
<a class="sourceLine" id="cb3-32" data-line-number="32">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> deseq2_pv, <span class="dt">lfc =</span> deseq2_lfc),</a>
<a class="sourceLine" id="cb3-33" data-line-number="33">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-34" data-line-number="34">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb3-35" data-line-number="35">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb3-36" data-line-number="36">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>, <span class="dt">func =</span> edgeR_run,</a>
<a class="sourceLine" id="cb3-38" data-line-number="38">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> edgeR_pv, <span class="dt">lfc =</span> edgeR_lfc),</a>
<a class="sourceLine" id="cb3-39" data-line-number="39">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-40" data-line-number="40">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb3-41" data-line-number="41">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-42" data-line-number="42"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>, <span class="dt">func =</span> voom_run,</a>
<a class="sourceLine" id="cb3-43" data-line-number="43">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> voom_pv, <span class="dt">lfc =</span> voom_lfc), </a>
<a class="sourceLine" id="cb3-44" data-line-number="44">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb3-45" data-line-number="45">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb3-46" data-line-number="46">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition))</a>
<a class="sourceLine" id="cb3-47" data-line-number="47"></a>
<a class="sourceLine" id="cb3-48" data-line-number="48">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">truthCols =</span> <span class="kw">c</span>(<span class="dt">pv =</span> <span class="st">"status"</span>, <span class="dt">lfc =</span> <span class="st">"lfc"</span>))</a></code></pre></div>
</div>
</div>
<div id="using-updatebench" class="section level1">
<h1 class="hasAnchor">
<a href="#using-updatebench" class="anchor"></a>Using updateBench</h1>
<p>First, the <code><a href="../reference/updateBench.html">updateBench()</a></code> can be called with just a single <em>SummarizedBenchmark</em> object to see if any of the methods have become outdated. By default, the function will not actually run any methods.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb)</a></code></pre></div>
<pre><code>## Warning: The `printer` argument is soft-deprecated as of rlang 0.3.0.
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `list_len()` is soft-deprecated as of rlang 0.2.0.
## Please use `new_list()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `chr_along()` is soft-deprecated as of rlang 0.2.0.
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `lang()` is soft-deprecated as of rlang 0.2.0.
## Please use `call2()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `new_overscope()` is soft-deprecated as of rlang 0.2.0.
## Please use `new_data_mask()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: Creating a condition with `cnd_signal()` is soft-deprecated as of rlang 0.3.0.
## Please use `signal()` instead.
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `.mufflable` is soft-deprecated as of rlang 0.3.0 and no longer has any effect
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `is_lang()` is soft-deprecated as of rlang 0.2.0.
## Please use `is_call()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `lang_modify()` is soft-deprecated as of rlang 0.2.0.
## Please use `call_modify()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `lgl_len()` is soft-deprecated as of rlang 0.2.0.
## Please use `new_logical()` instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Warning: `overscope_eval_next()` is soft-deprecated as of rlang 0.2.0.
## Please use `eval_tidy()` with a data mask instead
## This warning is displayed once per session.</code></pre>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged (full data missing)
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: ??</code></pre>
<pre><code>## Warning: `mut_node_car()` is soft-deprecated as of rlang 0.2.0.
## This warning is displayed once per session.</code></pre>
<pre><code>##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       N  |     N     N     N     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |</code></pre>
<p>The output is a table showing whether any methods need to be re-evaluated, as well as which components of the methods are now outdated. Here, the headings correspond to:</p>
<ul>
<li>
<code>Func</code>: the main method function,</li>
<li>
<code>Param</code>: the method parameters,</li>
<li>
<code>Meta</code>: the manually specified method metadata,</li>
<li>
<code>Post</code>: the post-processing functions,</li>
<li>
<code>Vers</code>: the corresponding package version for the main method.</li>
</ul>
<p>As can be seen by the <code>N</code>s under <code>Need to (Re)Run</code>, all results in the <em>SummarizedBenchmark</em> are still valid, and no method needs to be re-run. Also note that the benchmark data is listed as <code>full data missing</code>. This is because our <em>SummarizedBenchmark</em> object only contains a <strong>MD5 hash</strong> of the original data. (Optionally, the full data could have been stored with the <em>SummarizedBenchmark</em> object by specifying <code>keepData = TRUE</code> in the original <code><a href="../reference/buildBench.html">buildBench()</a></code> call above. However, by default this is not done to prevent making duplicating large data sets.) If any of the methods needed to be updated, the original data must be specified to <code><a href="../reference/updateBench.html">updateBench()</a></code> using the <code>data =</code> parameter.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(<span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(sb))</a></code></pre></div>
<pre><code>## BenchDesign Data (BDData) ---------------------------------- 
##   type: md5hash 
##   MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685</code></pre>
<p>The second way to call <code><a href="../reference/updateBench.html">updateBench()</a></code> is to specify both a <em>SummarizedBenchmark</em> object and a <em>BenchDesign</em> object. Intuitively, this will result in updating the results of the <em>SummarizedBenchmark</em> object to include any new or modified methods in the <em>BenchDesign</em>. Methods between the two objects are matched by the method label, e.g. <code>deseq2</code>. As an example, suppose we modify one of the methods in the <em>BenchDesign</em> object and want to rerun the benchmarking experiment. We first create a modified <em>BenchDesign</em> object, where we modify a single method’s manually specified meta data. Note that this is just a trivial update and normally would not warrant updating the results.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">bd2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modifyMethod.html">modifyMethod</a></span>(bd, <span class="st">"deseq2"</span>, rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">bd.meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"minor update"</span>)))</a></code></pre></div>
<p>Next, we pass the object to <code><a href="../reference/updateBench.html">updateBench()</a></code> along with the original <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |</code></pre>
<p>Notice that now the <code>Need to (Re)Run</code> and <code>Meta</code> columns are now set to <code>Y</code> for the <code>deseq2</code> method, indicating that the metadata of the method has become outdated in the <em>SummarizedBenchmark</em> object, and the method now needs to be rerun. Next, suppose we also decide to add a new method to our comparison. Here, we add an alternate version of DESeq2 to the comparison based on adaptive shrinkage (ASH) <span class="citation">(Stephens 2017)</span>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">deseq2_ashr &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData,</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">                                  <span class="dt">colData =</span> colData,</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">                                  <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    <span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/lfcShrink">lfcShrink</a></span>(dds, <span class="dt">contrast =</span> contrast, <span class="dt">type =</span> <span class="st">"ashr"</span>)</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb24-8" data-line-number="8"></a>
<a class="sourceLine" id="cb24-9" data-line-number="9">bd2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(bd2, <span class="st">"deseq2_ashr"</span>, </a>
<a class="sourceLine" id="cb24-10" data-line-number="10">                 deseq2_ashr,</a>
<a class="sourceLine" id="cb24-11" data-line-number="11">                 <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> deseq2_pv, <span class="dt">lfc =</span> deseq2_lfc),</a>
<a class="sourceLine" id="cb24-12" data-line-number="12">                 <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb24-13" data-line-number="13">                                      <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb24-14" data-line-number="14">                                      <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb24-15" data-line-number="15">                                      <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>)))</a></code></pre></div>
<p>Now we see that bo the modified <code>deseq2</code> and <code>deseq2_ashr</code> methods are listed as needing to be rerun.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |
##     | deseq2_ashr  |       Y  |     -     -     -     -     - |</code></pre>
<p>To run the update, we simply modify the call to <code><a href="../reference/updateBench.html">updateBench()</a></code> with <code>dryrun = FALSE</code>. When we do this, only the two methods needing to be rerun are evaluated.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">sb2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2, <span class="dt">dryrun =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">sb2</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 4 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(4): edgeR voom deseq2_ashr deseq2
## colData names(10): func.pkg func.pkg.vers ... session.idx
##   meta.note</code></pre>
<p>We can check the output to see that the results of the <code>deseq2_ashr</code> method have been added along with the updated <code>deseq2</code> results.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb2, <span class="st">"lfc"</span>))</a></code></pre></div>
<pre><code>##            edgeR       voom deseq2_ashr     deseq2
## [1,]   3.6767779  3.5232524  3.40956564  3.7329019
## [2,]  -5.3773940 -5.5543949 -5.32293234 -5.3905346
## [3,] -10.2467488 -8.2533275 -9.20816346 -9.7125453
## [4,]  -0.4547095 -1.0510456 -0.08956318 -0.4706410
## [5,]   3.7024426  3.9084940  3.61844615  3.7048724
## [6,]  -0.1504299 -0.7607029 -0.02921228 -0.1554938</code></pre>
<div id="benchmark-sessions" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-sessions" class="anchor"></a>Benchmark Sessions</h2>
<p>Notice that a session index is also stored in the column data of each method. This can be used to map methods quickly to the corresponding entry of the <code>sessions</code> list stored in the object metadata.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">colData</span>(sb2)[, <span class="st">"session.idx"</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<pre><code>## DataFrame with 4 rows and 1 column
##             session.idx
##               &lt;numeric&gt;
## edgeR                 1
## voom                  1
## deseq2_ashr           2
## deseq2                2</code></pre>
<p>As described in the <strong>SummarizedBenchmark: Class Details</strong> vignette, <code>sessions</code> is a list of session information stored in the metadata of the <em>SummarizedBenchmark</em> object. Each entry of the <code>sessions</code> list includes the names of methods for which the results were generated during that session, the corresponding method results, the run parameters, and the session info. We can check the list of methods for each session and see that it matches the <code>session.idx</code> values above.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">lapply</span>(<span class="kw">metadata</span>(sb2)<span class="op">$</span>sessions, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="st">"methods"</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] "edgeR" "voom" 
## 
## [[2]]
## [1] "deseq2_ashr" "deseq2"</code></pre>
<p>As another example, we can also compare the new <em>SummarizedBenchmark</em> object against the original <em>BenchDesign</em>. By default, <code><a href="../reference/updateBench.html">updateBench()</a></code> will keep all methods in the <em>SummarizedBenchmark</em> object even if a corresponding method is not found in the new <em>BenchDesign</em> object. To avoid this behavior, we can specify <code>keepAll = FALSE</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(sb2, bd, <span class="dt">keepAll =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |
##     | deseq2_ashr  |    Drop  |     -     -     -     -     - |</code></pre>
<p>As expected, the <code>deseq2</code> method must again be updated to return to match the original method definition, and the newer <code>deseq2_ashr</code> method must be dropped.</p>
</div>
</div>
<div id="updating-performance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#updating-performance-metrics" class="anchor"></a>Updating Performance Metrics</h1>
<p>If users update the <em>BenchDesign</em>, it is possible to calculate the performance metrics only for methods that have been added or modified. This feature is useful, for example, when performance metrics are computationally expensive to calculate. In the example below, we calculate the number of rejections at a nominal 10% FDR threshold for the original <em>SummarizedBenchmark</em> object. (Note that we do this rather than directly calculating the performance metrics for the newer <em>SummarizedBenchmark</em> object for illustrative purposes only.)</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addPerformanceMetric.html">addPerformanceMetric</a></span>(sb, <span class="dt">assay =</span> <span class="st">"pv"</span>, </a>
<a class="sourceLine" id="cb37-2" data-line-number="2">                           <span class="dt">evalMetric =</span> <span class="st">"rejections"</span>, </a>
<a class="sourceLine" id="cb37-3" data-line-number="3">                           <span class="dt">evalFunction =</span> <span class="cf">function</span>(query, truth) { </a>
<a class="sourceLine" id="cb37-4" data-line-number="4">                               <span class="kw">sum</span>(<span class="kw">p.adjust</span>(query, <span class="dt">method =</span> <span class="st">"BH"</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb37-5" data-line-number="5">                           })</a>
<a class="sourceLine" id="cb37-6" data-line-number="6">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, <span class="dt">addColData =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Then, we update the <em>BenchDesign</em> and rerun the function <code><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics()</a></code> with the parameter <code>rerun = FALSE</code>. Setting this parameter to <code>FALSE</code> will detect which performance metrics have been calculated before and will only recalculate metrics for methods that have been added or modified.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">sb2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(sb, bd2, <span class="dt">dryrun =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb2, <span class="dt">rerun =</span> <span class="ot">FALSE</span>, <span class="dt">addColData =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## 
## Option rerun is set to `FALSE`:
## Rerunning performance metrics only for the following methods: deseq2_ashr, deseq2</code></pre>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 4 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(4): edgeR voom deseq2_ashr deseq2
## colData names(12): func.pkg func.pkg.vers ... pm.session meta.note</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Stephens_2017">
<p>Stephens, Matthew. 2017. “False discovery rates: a new deal.” <em>Biostatistics</em> 18 (2):275–94. <a href="https://doi.org/10.1093/biostatistics/kxw041" class="uri">https://doi.org/10.1093/biostatistics/kxw041</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#using-updatebench">Using updateBench</a></li>
      <li><a href="#updating-performance-metrics">Updating Performance Metrics</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://alejandroreyes.org">Alejandro Reyes</a>, <a href="https://www.pkimes.com">Patrick Kimes</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
